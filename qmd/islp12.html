<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>islp12</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<link href="../https://assets.qiufei.site/personal/profile.jpg" rel="icon" type="image/jpeg">
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-681fbf911679f9b3dbf9743eb275ba49.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-7e49aeac8059a213a463aa1a739e8272.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://qiufei.github.io"> 
<span class="menu-text">首页</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://qiufei.github.io/web-slide-r"> 
<span class="menu-text">R课件</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://qiufei.github.io/web-slide-marketing"> 
<span class="menu-text">营销课件</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="introduction-to-unsupervised-learning" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-unsupervised-learning">Introduction to Unsupervised Learning</h2>
<div style="font-size: 0.8em;">
<p>So far, most of this course has focused on <strong>supervised learning</strong> methods like regression and classification.</p>
<ul>
<li><strong>Supervised Learning:</strong> We have a set of features (X1, X2, …, Xp) and a response variable (Y). The Goal is to <em>predict</em> Y using the Xs. We “teach” the algorithm.</li>
<li><strong>Examples:</strong> Linear regression, logistic regression, Support Vector Machine (SVM).</li>
</ul>
<p>Now, we’ll explore <strong>unsupervised learning</strong>.</p>
<ul>
<li><strong>Unsupervised Learning:</strong> We only have features (X1, X2, …, Xp), <em>without</em> any response variable Y. No “teaching” or “supervision”.</li>
<li><strong>Goal:</strong> Discover <em>interesting patterns</em> and <em>structure</em> in the data, find relationships.</li>
<li><strong>Examples:</strong> Principal Component Analysis (PCA), Clustering.</li>
</ul>
</div>
</section>
<section id="what-is-unsupervised-learning" class="level2">
<h2 class="anchored" data-anchor-id="what-is-unsupervised-learning">What is Unsupervised Learning?</h2>
<div style="font-size: 0.8em;">
<p>Unsupervised learning is a set of statistical tools designed for situations where we have only input features and no output or response variable. Since there’s no “correct answer” to guide the learning process, it’s called “unsupervised.” We’re exploring the data without a specific prediction task in mind.</p>
<p><strong>Key Goals:</strong></p>
<ul>
<li><strong>Data Visualization:</strong> Find ways to represent the data to see patterns.</li>
<li><strong>Discover Subgroups:</strong> Identify clusters or groups within the data or among the variables.</li>
<li><strong>Data Pre-processing:</strong> Prepare data for supervised learning.</li>
</ul>
<p>We will cover two major types:</p>
<ol type="1">
<li><strong>Principal Components Analysis (PCA):</strong> Used for visualization and pre-processing.</li>
<li><strong>Clustering:</strong> Discovering unknown subgroups in data.</li>
</ol>
</div>
</section>
<section id="supervised-vs.-unsupervised-learning" class="level2">
<h2 class="anchored" data-anchor-id="supervised-vs.-unsupervised-learning">Supervised vs.&nbsp;Unsupervised Learning</h2>
<div style="font-size: 0.8em;">
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 40%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Feature</th>
<th style="text-align: left;">Supervised Learning</th>
<th style="text-align: left;">Unsupervised Learning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Goal</strong></td>
<td style="text-align: left;">Predict a response variable (Y)</td>
<td style="text-align: left;">Discover patterns and structure</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Data</strong></td>
<td style="text-align: left;">Features (X) and response (Y)</td>
<td style="text-align: left;">Features (X) only</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Evaluation</strong></td>
<td style="text-align: left;">Clear metrics (e.g., accuracy, R-squared)</td>
<td style="text-align: left;">More subjective, harder to evaluate</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Examples</strong></td>
<td style="text-align: left;">Regression, classification</td>
<td style="text-align: left;">PCA, clustering</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>“Correct Answer”</strong></td>
<td style="text-align: left;">Yes (the response variable)</td>
<td style="text-align: left;">No (no response variable)</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Unsupervised learning is often more challenging because there’s no straightforward way to check our work. It’s more exploratory and subjective. We don’t have a “ground truth” to compare our results against.</p>
</div>
</div>
</div>
</div>
</section>
<section id="applications-of-unsupervised-learning" class="level2">
<h2 class="anchored" data-anchor-id="applications-of-unsupervised-learning">Applications of Unsupervised Learning</h2>
<div style="font-size: 0.8em;">
<p>Unsupervised learning is increasingly important in various fields:</p>
<ul>
<li><strong>Genomics:</strong> A cancer researcher analyzes gene expression levels in patients. Unsupervised learning can help find <em>subgroups</em> of patients or genes, leading to a better understanding of the disease.</li>
<li><strong>E-commerce:</strong> An online shopping site identifies groups of shoppers with similar browsing and purchase histories. This allows for <em>targeted recommendations</em>, showing each shopper items they’re more likely to be interested in.</li>
<li><strong>Search Engines:</strong> Search results can be customized based on the <em>click histories</em> of similar users.</li>
<li><strong>Marketing:</strong> Identify <em>market segments</em> (groups of customers) for targeted advertising.</li>
</ul>
<p>These are just a few examples. Unsupervised learning is a powerful tool for extracting insights from data where there’s no predefined outcome.</p>
</div>
</section>
<section id="principal-component-analysis-pca" class="level2">
<h2 class="anchored" data-anchor-id="principal-component-analysis-pca">Principal Component Analysis (PCA)</h2>
<div style="font-size: 0.8em;">
<p>Principal Component Analysis (PCA) is a technique to reduce the dimensionality of data while retaining as much <em>variability</em> (information) as possible. It’s like finding the most important “directions” in your data.</p>
<ul>
<li><strong>Dimensionality Reduction:</strong> Simplifies data by finding a smaller set of <em>representative variables</em> (principal components).</li>
<li><strong>Data Visualization:</strong> Allows us to visualize high-dimensional data in lower dimensions (e.g., 2D or 3D plots).</li>
<li><strong>Unsupervised:</strong> PCA only uses the features (X), not any response (Y).</li>
<li><strong>Feature Space Directions:</strong> Identifies the directions in the feature space along which the original data varies most.</li>
<li><strong>Data Pre-processing:</strong> Can be used to create new, uncorrelated features for use in supervised learning (e.g., Principal Components Regression).</li>
</ul>
</div>
</section>
<section id="what-are-principal-components" class="level2">
<h2 class="anchored" data-anchor-id="what-are-principal-components">What are Principal Components?</h2>
<div style="font-size: 0.8em;">
<p>Imagine you have many features (variables). PCA finds new variables, called <strong>principal components</strong>, that are <em>linear combinations</em> of the original features.</p>
<ul>
<li><p><strong>First Principal Component (Z1):</strong> The normalized linear combination of features with the <em>largest variance</em>. It captures the <em>most</em> variability in the data.</p>
<ul>
<li><strong>Normalized:</strong> The sum of the squared coefficients (loadings) equals 1. This prevents arbitrarily large variances.</li>
<li><strong>Loadings:</strong> The coefficients (φ) in the linear combination. They tell us how much each original feature contributes to the principal component.</li>
</ul></li>
<li><p><strong>Subsequent Principal Components:</strong> Linear combinations that capture the <em>most remaining variance</em>, subject to being <em>uncorrelated</em> with previous components.</p></li>
</ul>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Formula for the first principal component:</strong> <span class="math display">\[Z_1 = \phi_{11}X_1 + \phi_{21}X_2 + ... + \phi_{p1}X_p\]</span> where <span class="math inline">\(\sum_{j=1}^{p} \phi_{j1}^2 = 1\)</span> (normalization constraint).</p>
</div>
</div>
</div>
</div>
</section>
<section id="geometric-interpretation-of-pca" class="level2">
<h2 class="anchored" data-anchor-id="geometric-interpretation-of-pca">Geometric Interpretation of PCA</h2>
<div style="font-size: 0.8em;">
<p>The principal component loading vectors define directions in the feature space.</p>
<ul>
<li><strong>First Principal Component:</strong> The direction along which the data points <em>vary the most</em>.</li>
<li><strong>Second Principal Component:</strong> The direction, <em>orthogonal</em> (perpendicular) to the first, that captures the <em>next most variance</em>. And so on.</li>
</ul>
<p>Projecting the original data points onto these directions gives us the <strong>principal component scores</strong>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/6_14.png" class="img-fluid figure-img"></p>
<figcaption>alt text</figcaption>
</figure>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>In the figure, which displays an advertising data, the green solid line represents the first principal component direction. The blue dashed line represents the second. Since this is a 2D example, there are only two components.</p>
</div>
</div>
</div>
</div>
</section>
<section id="example-usarrests-data" class="level2">
<h2 class="anchored" data-anchor-id="example-usarrests-data">Example: USArrests Data</h2>
<div style="font-size: 0.8em;">
<p>Let’s look at an example using the <code>USArrests</code> dataset, which contains crime statistics for each of the 50 US states:</p>
<ul>
<li><strong>Features:</strong> <code>Murder</code>, <code>Assault</code>, <code>UrbanPop</code>, <code>Rape</code> (per 100,000 residents)</li>
<li><strong>Goal:</strong> Visualize the data and find patterns using PCA.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/12_1.png" class="img-fluid figure-img"></p>
<figcaption>First two principal components for the USArrests data.</figcaption>
</figure>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This is a <strong>biplot</strong>. It shows both the principal component <em>scores</em> (blue state names) and the principal component <em>loadings</em> (orange arrows). For example, the loading for <code>Rape</code> on the first component is 0.54, and on the second component is 0.17. The word <code>Rape</code> is centered at the point (0.54, 0.17).</p>
</div>
</div>
</div>
</div>
</section>
<section id="interpreting-the-usarrests-biplot" class="level2">
<h2 class="anchored" data-anchor-id="interpreting-the-usarrests-biplot">Interpreting the USArrests Biplot</h2>
<div style="font-size: 0.8em;">
<ul>
<li><strong>First Principal Component (PC1):</strong> Places roughly equal weight on <code>Murder</code>, <code>Assault</code>, and <code>Rape</code>, with much less weight on <code>UrbanPop</code>. This component represents overall crime rates.</li>
<li><strong>Second Principal Component (PC2):</strong> Places most of its weight on <code>UrbanPop</code>, representing the level of urbanization.</li>
<li><strong>Correlation:</strong> <code>Murder</code>, <code>Assault</code>, and <code>Rape</code> are close together, indicating they are correlated. <code>UrbanPop</code> is farther away, indicating it’s less correlated with the other three.</li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">PC1</th>
<th style="text-align: left;">PC2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Murder</td>
<td style="text-align: left;">0.536</td>
<td style="text-align: left;">-0.418</td>
</tr>
<tr class="even">
<td style="text-align: left;">Assault</td>
<td style="text-align: left;">0.583</td>
<td style="text-align: left;">-0.188</td>
</tr>
<tr class="odd">
<td style="text-align: left;">UrbanPop</td>
<td style="text-align: left;">0.278</td>
<td style="text-align: left;">0.873</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rape</td>
<td style="text-align: left;">0.543</td>
<td style="text-align: left;">0.167</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The table shows loading vectors. States with large positive scores on PC1 (e.g., California, Nevada, Florida) have high crime rates. States with large positive scores on PC2 (e.g., California) have high urbanization.</p>
</div>
</div>
</div>
</div>
</section>
<section id="another-interpretation-of-pca" class="level2">
<h2 class="anchored" data-anchor-id="another-interpretation-of-pca">Another Interpretation of PCA</h2>
<div style="font-size: 0.8em;">
<p>Besides finding directions of greatest variance, PCA also finds <em>linear surfaces</em> that are closest to the data points.</p>
<ul>
<li><strong>First Principal Component:</strong> The <em>line</em> in p-dimensional space closest to the n observations (in terms of average squared Euclidean distance).</li>
<li><strong>First Two Principal Components:</strong> The <em>plane</em> closest to the observations.</li>
<li><strong>And so on…</strong></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/12_2a.png" class="img-fluid figure-img"></p>
<figcaption>Ninety observations simulated in three dimensions.</figcaption>
</figure>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p><em>Left</em>: The first two principal component directions span the plane that best fits the data. <em>Right</em>: The first two principal component score vectors give the coordinates of the projection of the 90 observations onto the plane.</p>
</div>
</div>
</div>
</div>
</section>
<section id="proportion-of-variance-explained-pve" class="level2">
<h2 class="anchored" data-anchor-id="proportion-of-variance-explained-pve">Proportion of Variance Explained (PVE)</h2>
<div style="font-size: 0.8em;">
<p>How much information is <em>lost</em> when we project data onto the first few principal components? We use the <strong>Proportion of Variance Explained (PVE)</strong> to measure this.</p>
<ul>
<li><strong>Total Variance:</strong> The sum of the variances of all the original features (assuming they are centered).</li>
<li><strong>Variance Explained by the m-th PC:</strong> The variance of the m-th principal component.</li>
<li><strong>PVE of the m-th PC:</strong> The <em>proportion</em> of the total variance explained by the m-th principal component.</li>
</ul>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p><strong>Formula for PVE of the m-th PC:</strong> <span class="math display">\[\frac{\sum_{i=1}^{n} z_{im}^2}{\sum_{j=1}^{p} \sum_{i=1}^{n} x_{ij}^2}\]</span></p>
</div>
</div>
</div>
</div>
</section>
<section id="pve-usarrests-example" class="level2">
<h2 class="anchored" data-anchor-id="pve-usarrests-example">PVE: USArrests Example</h2>
<div style="font-size: 0.8em;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/12_3.png" class="img-fluid figure-img"></p>
<figcaption>Scree plot and cumulative PVE plot for the USArrests data.</figcaption>
</figure>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p><em>Left</em>: A <strong>scree plot</strong>, showing the PVE of each principal component. <em>Right</em>: The cumulative PVE.</p>
</div>
</div>
</div>
<ul>
<li><strong>PC1:</strong> Explains 62.0% of the variance.</li>
<li><strong>PC2:</strong> Explains 24.7% of the variance.</li>
<li><strong>Together:</strong> PC1 and PC2 explain almost 87% of the variance.</li>
</ul>
<p>This means that Figure 12.1 (the biplot) provides a good two-dimensional summary of the data. The scree plot helps us decide how many components to keep (look for an “elbow”).</p>
</div>
</section>
<section id="scaling-the-variables" class="level2">
<h2 class="anchored" data-anchor-id="scaling-the-variables">Scaling the Variables</h2>
<div style="font-size: 0.8em;">
<p>Before performing PCA, we usually <em>scale</em> the variables to have a standard deviation of one.</p>
<ul>
<li><strong>Why scale?</strong> If variables are measured in different units or have vastly different variances, the variables with the <em>largest variances</em> will dominate the principal components, regardless of whether they are actually the most <em>important</em>.</li>
<li><strong>Exception:</strong> If variables are measured in the <em>same units</em> (e.g., gene expression levels), we might <em>not</em> want to scale.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/12_4.png" class="img-fluid figure-img"></p>
<figcaption>Effect of scaling on the USArrests biplot.</figcaption>
</figure>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p><em>Left</em>: PCA with scaled variables (like Figure 12.1). <em>Right</em>: PCA with unscaled variables. <code>Assault</code> dominates the first PC because it has the highest variance.</p>
</div>
</div>
</div>
</div>
</section>
<section id="how-many-principal-components-to-use" class="level2">
<h2 class="anchored" data-anchor-id="how-many-principal-components-to-use">How Many Principal Components to Use?</h2>
<div style="font-size: 0.8em;">
<p>There’s no single, definitive answer. It depends on the context and the data.</p>
<ul>
<li><strong>Scree Plot:</strong> Look for an “elbow” in the scree plot – a point where the PVE drops off significantly.</li>
<li><strong>Interpretation:</strong> Keep enough components to capture the <em>interesting patterns</em> in the data.</li>
<li><strong>Ad Hoc:</strong> This process is inherently subjective.</li>
<li><strong>Supervised Learning:</strong> If PCA is used for pre-processing for supervised learning (e.g., Principal Components Regression), we can use cross-validation to select the number of components.</li>
</ul>
</div>
</section>
<section id="clustering-methods" class="level2">
<h2 class="anchored" data-anchor-id="clustering-methods">Clustering Methods</h2>
<div style="font-size: 0.8em;">
<p>Clustering aims to find <em>subgroups</em> (clusters) within a dataset.</p>
<ul>
<li><strong>Goal:</strong> Partition observations into groups so that observations <em>within</em> a group are similar, and observations in <em>different</em> groups are dissimilar.</li>
<li><strong>Similarity:</strong> What does “similar” mean? This is a crucial, often domain-specific, consideration.</li>
<li><strong>Unsupervised:</strong> We’re looking for structure without a predefined outcome.</li>
</ul>
<p>We’ll cover two main types:</p>
<ol type="1">
<li><strong>K-Means Clustering:</strong> Partitions data into a <em>pre-specified</em> number (K) of clusters.</li>
<li><strong>Hierarchical Clustering:</strong> Builds a <em>hierarchy</em> of clusters, represented by a dendrogram.</li>
</ol>
</div>
</section>
<section id="k-means-clustering" class="level2">
<h2 class="anchored" data-anchor-id="k-means-clustering">K-Means Clustering</h2>
<div style="font-size: 0.8em;">
<p>K-means clustering is a simple and widely used clustering algorithm.</p>
<ul>
<li><strong>Input:</strong> A dataset and a desired number of clusters, <em>K</em>.</li>
<li><strong>Output:</strong> Assigns each observation to <em>exactly one</em> of K clusters.</li>
<li><strong>Goal:</strong> Minimize the <em>within-cluster variation</em>.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/12_7.png" class="img-fluid figure-img"></p>
<figcaption>K-means clustering results on simulated data.</figcaption>
</figure>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The results of applying K-means clustering with different values of K (the number of clusters) are presented. The color of each observation indicates the cluster to which it was assigned.</p>
</div>
</div>
</div>
</div>
</section>
<section id="the-k-means-algorithm" class="level2">
<h2 class="anchored" data-anchor-id="the-k-means-algorithm">The K-Means Algorithm</h2>
<div style="font-size: 0.8em;">
<ol type="1">
<li><strong>Initialization:</strong> Randomly assign each observation to one of the K clusters.</li>
<li><strong>Iteration:</strong> Repeat until the cluster assignments stop changing:
<ol type="a">
<li><strong>Compute Centroids:</strong> For each cluster, calculate the <em>centroid</em> (the mean vector of the observations in that cluster).</li>
<li><strong>Reassign Observations:</strong> Assign each observation to the cluster whose centroid is <em>closest</em> (usually using Euclidean distance).</li>
</ol></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The algorithm is guaranteed to decrease the within-cluster variation at each step. It finds a <em>local</em> optimum, not necessarily the global optimum.</p>
</div>
</div>
</div>
</section>
<section id="k-means-an-illustrative-example" class="level2">
<h2 class="anchored" data-anchor-id="k-means-an-illustrative-example">K-Means: An Illustrative Example</h2>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph LR
    A[Data] --&gt; B(Step 1: Randomly Assign Clusters);
    B --&gt; C(Iteration 1, Step 2a: Compute Centroids);
    C --&gt; D(Iteration 1, Step 2b: Reassign Observations);
    D --&gt; E(Iteration 2, Step 2a: Compute Centroids);
     E --&gt; F(Iteration 2, Step 2b: Reassign Observations);
    F --&gt; G(Final Results);
    style A fill:#f9f,stroke:#333,stroke-width:2px
    style G fill:#ccf,stroke:#333,stroke-width:4px
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/12_8.png" class="img-fluid figure-img"></p>
<figcaption>Progress of the K-means algorithm.</figcaption>
</figure>
</div>
</section>
<section id="k-means-local-optima" class="level2">
<h2 class="anchored" data-anchor-id="k-means-local-optima">K-Means: Local Optima</h2>
<div style="font-size: 0.8em;">
<p>Because K-means finds a local optimum, the results depend on the <em>initial random assignment</em> of observations to clusters.</p>
<ul>
<li><strong>Recommendation:</strong> Run K-means multiple times with different initializations and choose the solution with the <em>lowest</em> within-cluster variation.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/12_9.png" class="img-fluid figure-img"></p>
<figcaption>K-means clustering with different initializations.</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>K-means clustering was performed six times on the data, each with a different random assignment of observations. Three different local optima were obtained, one of which resulted in better separation between the clusters.</p>
</div>
</div>
</div>
</section>
<section id="hierarchical-clustering" class="level2">
<h2 class="anchored" data-anchor-id="hierarchical-clustering">Hierarchical Clustering</h2>
<div style="font-size: 0.8em;">
<p>Hierarchical clustering builds a <em>hierarchy</em> of clusters, represented by a <strong>dendrogram</strong>.</p>
<ul>
<li><strong>Advantage:</strong> Doesn’t require pre-specifying the number of clusters (K). We can choose the number of clusters by “cutting” the dendrogram.</li>
<li><strong>Dendrogram:</strong> A tree-like diagram that shows how clusters are merged.</li>
<li><strong>Agglomerative (Bottom-Up):</strong> Start with each observation as its own cluster, and successively merge the most similar clusters.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/12_11.png" class="img-fluid figure-img"></p>
<figcaption>Dendrogram of hierarchically clustering the data.</figcaption>
</figure>
</div>
</div>
</section>
<section id="interpreting-a-dendrogram" class="level2">
<h2 class="anchored" data-anchor-id="interpreting-a-dendrogram">Interpreting a Dendrogram</h2>
<div style="font-size: 0.8em;">
<ul>
<li><strong>Leaves:</strong> Represent individual observations.</li>
<li><strong>Fusions:</strong> As you move up the tree, leaves and branches <em>fuse</em>, representing the merging of similar clusters.</li>
<li><strong>Height of Fusion:</strong> Indicates the <em>dissimilarity</em> between the merged clusters. Lower fusions mean more similar clusters.</li>
<li><strong>Cutting the Dendrogram:</strong> A horizontal cut across the dendrogram gives a specific number of clusters. The height of the cut determines the number of clusters.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/12_12.png" class="img-fluid figure-img"></p>
<figcaption>Interpreting a dendrogram.</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The figure illustrates how to <em>properly</em> interpret a dendrogram. <em>Left</em>: A dendrogram generated using Euclidean distance and complete linkage. Observations 5 and 7 are quite similar. <em>Right</em>: The raw data used to generate the dendrogram.</p>
</div>
</div>
</div>
</section>
<section id="the-hierarchical-clustering-algorithm" class="level2">
<h2 class="anchored" data-anchor-id="the-hierarchical-clustering-algorithm">The Hierarchical Clustering Algorithm</h2>
<div style="font-size: 0.8em;">
<ol type="1">
<li><strong>Initialization:</strong> Start with each observation as its own cluster (n clusters). Calculate all pairwise dissimilarities (e.g., using Euclidean distance).</li>
<li><strong>Iteration:</strong> For i = n, n-1, …, 2:
<ol type="a">
<li><strong>Find Most Similar Clusters:</strong> Identify the two <em>most similar</em> clusters (least dissimilar).</li>
<li><strong>Merge Clusters:</strong> <em>Fuse</em> these two clusters into a single cluster. The dissimilarity between these clusters is the <em>height</em> in the dendrogram where they fuse.</li>
<li><strong>Update Dissimilarities:</strong> Calculate the new pairwise inter-cluster dissimilarities between the remaining i-1 clusters.</li>
</ol></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Key Question:</strong> How do we define the dissimilarity between <em>clusters</em> (groups of observations), not just individual observations? This is where <strong>linkage</strong> comes in.</p>
</div>
</div>
</div>
</section>
<section id="linkage" class="level2">
<h2 class="anchored" data-anchor-id="linkage">Linkage</h2>
<div style="font-size: 0.8em;">
<p><strong>Linkage</strong> defines the dissimilarity between two <em>groups</em> of observations.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 8%">
<col style="width: 91%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Linkage</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Complete</td>
<td style="text-align: left;"><em>Maximal</em> intercluster dissimilarity (dissimilarity between the <em>most dissimilar</em> points in the two clusters).</td>
</tr>
<tr class="even">
<td style="text-align: left;">Single</td>
<td style="text-align: left;"><em>Minimal</em> intercluster dissimilarity (dissimilarity between the <em>most similar</em> points in the two clusters).</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Average</td>
<td style="text-align: left;"><em>Mean</em> intercluster dissimilarity (average dissimilarity between all pairs of points in the two clusters).</td>
</tr>
<tr class="even">
<td style="text-align: left;">Centroid</td>
<td style="text-align: left;">Dissimilarity between the <em>centroids</em> of the two clusters.</td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Average and complete linkage are generally preferred. Centroid linkage can lead to undesirable <em>inversions</em>.</p>
</div>
</div>
</div>
</section>
<section id="choice-of-dissimilarity-measure" class="level2">
<h2 class="anchored" data-anchor-id="choice-of-dissimilarity-measure">Choice of Dissimilarity Measure</h2>
<div style="font-size: 0.8em;">
<p>Besides linkage, we also need to choose a <em>dissimilarity measure</em> between individual observations.</p>
<ul>
<li><strong>Euclidean Distance:</strong> The most common choice. Measures the straight-line distance between two points.</li>
<li><strong>Correlation-Based Distance:</strong> Considers two observations similar if their features are <em>highly correlated</em>, even if their values are far apart in terms of Euclidean distance.</li>
</ul>
<p>The choice depends on the <em>type of data</em> and the <em>scientific question</em>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/12_15.png" class="img-fluid figure-img"></p>
<figcaption>Euclidean vs.&nbsp;correlation-based distance.</figcaption>
</figure>
</div>
</div>
</section>
<section id="practical-issues-in-clustering" class="level2">
<h2 class="anchored" data-anchor-id="practical-issues-in-clustering">Practical Issues in Clustering</h2>
<div style="font-size: 0.8em;">
<ul>
<li><strong>Scaling:</strong> Should we scale the variables before clustering? (Usually yes, to give equal weight to each variable.)</li>
<li><strong>Small Decisions, Big Consequences:</strong> Choices of dissimilarity measure, linkage, and scaling can have a <em>large impact</em> on the results.</li>
<li><strong>Validating Clusters:</strong> It’s hard to know if the clusters found are <em>real</em> or just an artifact of the clustering process.</li>
<li><strong>Robustness:</strong> Clustering methods are often <em>not very robust</em> to small changes in the data.</li>
</ul>
<p><strong>Recommendation:</strong> Try different choices, look for consistent patterns, and be cautious about over-interpreting the results. Clustering should be a starting point for further investigation, not the final answer.</p>
</div>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<div style="font-size: 0.8em;">
<ul>
<li><strong>Unsupervised learning</strong> is about finding patterns and structure in data <em>without</em> a response variable.</li>
<li><strong>PCA</strong> reduces dimensionality by finding linear combinations of features that capture the most variance. It’s useful for visualization and pre-processing.</li>
<li><strong>Clustering</strong> aims to find subgroups within the data.
<ul>
<li><strong>K-means</strong> requires pre-specifying the number of clusters (K).</li>
<li><strong>Hierarchical clustering</strong> builds a hierarchy of clusters, represented by a dendrogram.</li>
</ul></li>
<li>Choices of dissimilarity measure, linkage (for hierarchical clustering), and scaling can significantly affect clustering results.</li>
<li>Clustering is a powerful but often subjective and non-robust technique. It’s best used for exploration and hypothesis generation.</li>
</ul>
</div>
</section>
<section id="thoughts-and-discussion" class="level2">
<h2 class="anchored" data-anchor-id="thoughts-and-discussion">Thoughts and Discussion</h2>
<div style="font-size: 0.8em;">
<ul>
<li>Can you think of other real-world applications where unsupervised learning might be useful?</li>
<li>What are the potential limitations of relying too heavily on clustering results without further validation?</li>
<li>How might you combine supervised and unsupervised learning techniques in a single analysis?</li>
<li>How do you understand the differences and connections between data mining, machine learning, and statistical learning?</li>
</ul>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/qiufei\.github\.io\/web-slide-r");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>🔋<a href="https://posit.co"><img src="https://posit.co/wp-content/themes/Posit/assets/images/posit-logo-2024.png" class="img-fluid" alt="Posit" width="65"></a></p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 邱飞 © 2025
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://beian.miit.gov.cn">
<p>浙ICP备 2024072710号-1</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33021202002511">
<p>浙公网安备 33021202002511号</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:hfutqiufei@163.com">
      <i class="bi bi-envelope-at-fill" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>