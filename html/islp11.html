<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>islp11</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<link href="../https://assets.qiufei.site/personal/profile.jpg" rel="icon" type="image/jpeg">
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-d166b450ba5a8e9f7a0ab969bf6592c1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-eeb6d1c97efeeb0cfaf56837413d2c8e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-8aa8884591a9136173b71f6048871fae.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://qiufei.github.io"> 
<span class="menu-text">È¶ñÈ°µ</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://qiufei.github.io/web-slide-r"> 
<span class="menu-text">RËØæ‰ª∂</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://qiufei.github.io/web-slide-marketing"> 
<span class="menu-text">Ëê•ÈîÄËØæ‰ª∂</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<div style="font-size: 0.8em;">
<p>Welcome to the fascinating world of <strong>survival analysis</strong>! üï∞Ô∏è In this chapter, we delve into analyzing a unique type of data: the <em>time until an event occurs</em>. This is different from typical regression problems because of a crucial concept: <strong>censoring</strong>.</p>
<p>Think of a medical study tracking patient survival after cancer treatment. Some patients might still be alive at the study‚Äôs end. We know they survived <em>at least</em> that long, but not their exact survival time. This is censored data.</p>
<p><strong>Key Concepts:</strong> - <strong>Survival Analysis:</strong> Statistical methods for analyzing time-to-event data. - <strong>Censored Data:</strong> Observations where the event of interest has not occurred for all subjects by the end of the observation period. - <strong>Event:</strong> The outcome of interest (e.g., death, recovery, machine failure, customer churn). - <strong>Survival Time:</strong> The time until the event occurs.</p>
<p>We will explore how to deal with censoring and effectively extract information using tools like survival analysis.</p>
</div>
</section>
<section id="why-survival-analysis" class="level2">
<h2 class="anchored" data-anchor-id="why-survival-analysis">Why Survival Analysis?</h2>
<div style="font-size: 0.8em;">
<p>Survival analysis isn‚Äôt limited to medical studies. It‚Äôs relevant in many fields:</p>
<ul>
<li><strong>Medicine:</strong> Predicting patient survival times, time to disease recurrence.</li>
<li><strong>Business:</strong> Modeling customer churn (time until a customer cancels a subscription).</li>
<li><strong>Engineering:</strong> Assessing the reliability of components (time until failure).</li>
<li><strong>Finance:</strong> Evaluating credit risk (time until default).</li>
<li><strong>Even beyond time:</strong> Modeling weight when scales have upper limits. Any weight above that limit is censored.</li>
</ul>
<div class="incremental">
<ul class="incremental">
<li><strong>Key Insight:</strong> Survival analysis techniques allows us to work with <em>incomplete</em> information. We don‚Äôt need to observe the event for every individual to gain valuable insights.</li>
</ul>
</div>
</div>
</section>
<section id="survival-and-censoring-times" class="level2">
<h2 class="anchored" data-anchor-id="survival-and-censoring-times">Survival and Censoring Times</h2>
<div style="font-size: 0.8em;">
<p>Let‚Äôs define some core concepts:</p>
<ul>
<li><strong>Survival Time (T):</strong> The true time until the event of interest occurs. Also called <em>failure time</em> or <em>event time</em>.</li>
<li><strong>Censoring Time (C):</strong> The time at which observation ends, either because the study ends, the patient drops out, or the event occurs.</li>
<li><strong>Observed Time (Y):</strong> What we actually see: either the survival time or the censoring time. Mathematically, Y = min(T, C).</li>
<li><strong>Status Indicator (Œ¥):</strong> Tells us whether we observed the event (Œ¥ = 1) or the observation was censored (Œ¥ = 0).</li>
</ul>
<p><span class="math display">\[
\delta =
\begin{cases}
1 &amp; \text{if } T \leq C \text{ (event observed)} \\
0 &amp; \text{if } T &gt; C \text{ (censored)}
\end{cases}
\]</span></p>
<p>These variables form the basis of survival analysis.</p>
</div>
</section>
<section id="visualizing-censored-data" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-censored-data">Visualizing Censored Data</h2>
<div style="font-size: 0.8em;">
<p>Let‚Äôs consider a simple example:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://axwslyfy9krb.objectstorage.ap-singapore-1.oci.customer-oci.com/n/axwslyfy9krb/b/qiufei/o/textbook%2Fisl_figures%2F11_1.svg" class="img-fluid figure-img"></p>
<figcaption>alt text</figcaption>
</figure>
</div>
<div class="fragment">
<ul>
<li><strong>Patients 1 &amp; 3:</strong> The event (e.g., death) was <em>observed</em>. We know their exact survival times.</li>
<li><strong>Patient 2:</strong> Was <em>alive</em> at the end of the study. Their survival time is censored.</li>
<li><strong>Patient 4:</strong> <em>Dropped out</em> of the study. Also censored.</li>
</ul>
</div>
<div class="fragment">
<p><strong>Important:</strong> Censored observations still provide valuable information! They tell us the event <em>didn‚Äôt</em> happen before a certain time.</p>
</div>
</div>
</section>
<section id="a-closer-look-at-censoring" class="level2">
<h2 class="anchored" data-anchor-id="a-closer-look-at-censoring">A Closer Look at Censoring</h2>
<div style="font-size: 0.8em;">
<p>Censoring isn‚Äôt always straightforward. The <em>reason</em> for censoring matters.</p>
<div class="nonincremental">
<ul>
<li><strong>Independent Censoring:</strong> The censoring mechanism is unrelated to the survival time (conditional on features). This is a crucial assumption for many survival analysis methods.</li>
<li><strong>Example of violation:</strong> Patients dropping out because they are very sick. This biases the results, making survival times seem longer than they are.</li>
</ul>
</div>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p><strong>Types of Censoring</strong></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<ul>
<li><strong>Right Censoring:</strong> Most common. We know the event time is <em>greater than</em> the observed time (T ‚â• Y).</li>
<li><strong>Left Censoring:</strong> We know the event time is <em>less than or equal</em> to the observed time.</li>
<li><strong>Interval Censoring:</strong> We know the event time falls within a specific interval.</li>
</ul>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://axwslyfy9krb.objectstorage.ap-singapore-1.oci.customer-oci.com/n/axwslyfy9krb/b/qiufei/o/textbook%2Fisl_figures%2F11_1.svg" class="img-fluid figure-img"></p>
<figcaption>alt text</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We will focus mainly on <strong>right censoring</strong>, the most prevalent type in practice.</p>
</div>
</div>
</div>
</section>
<section id="the-kaplan-meier-survival-curve" class="level2">
<h2 class="anchored" data-anchor-id="the-kaplan-meier-survival-curve">The Kaplan-Meier Survival Curve</h2>
<div style="font-size: 0.8em;">
<p>The <strong>survival curve</strong>, denoted by S(t), is a fundamental concept. It gives the probability of surviving <em>past</em> time t:</p>
<p><span class="math display">\[S(t) = Pr(T &gt; t)\]</span></p>
<div class="fragment">
<p>The larger the value of S(t), the more likely the event will occur at time greater than t.</p>
</div>
<div class="fragment">
<p>How do we estimate S(t) from data with censoring? The <strong>Kaplan-Meier estimator</strong> is a powerful tool.</p>
</div>
</div>
</section>
<section id="estimating-the-survival-curve-challenges" class="level2">
<h2 class="anchored" data-anchor-id="estimating-the-survival-curve-challenges">Estimating the Survival Curve: Challenges</h2>
<div style="font-size: 0.8em;">
<p>Let‚Äôs consider the <code>BrainCancer</code> dataset. We want to estimate S(20): the probability of surviving at least 20 months. Naive approaches fail:</p>
<ol type="1">
<li><strong>Simply using Y &gt; 20:</strong> This ignores that Y is not always the true survival time (due to censoring). It underestimates survival.</li>
<li><strong>Ignoring censored observations:</strong> This throws away valuable information. A patient censored at 19.9 months almost certainly would have survived past 20.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Kaplan-Meier estimator elegantly handles censoring to provide a more accurate estimate.</p>
</div>
</div>
</div>
</section>
<section id="the-kaplan-meier-estimator-intuition" class="level2">
<h2 class="anchored" data-anchor-id="the-kaplan-meier-estimator-intuition">The Kaplan-Meier Estimator: Intuition</h2>
<div style="font-size: 0.8em;">
<p>The Kaplan-Meier estimator works <em>sequentially</em>, considering events as they unfold in time.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<ul>
<li><p><strong>Key Idea:</strong> At each death time, we calculate the <em>conditional</em> probability of surviving that time point, given survival up to that point.</p></li>
<li><p>We then multiply these conditional probabilities together to get the overall survival probability.</p></li>
<li><p>Let <span class="math inline">\(d_1 &lt; d_2 &lt; ... &lt; d_K\)</span> be the distinct death times.</p></li>
<li><p><span class="math inline">\(q_k\)</span>: Number of deaths at time <span class="math inline">\(d_k\)</span>.</p></li>
<li><p><span class="math inline">\(r_k\)</span>: Number of individuals <em>at risk</em> (alive and in the study) just before <span class="math inline">\(d_k\)</span>. This is the <em>risk set</em>.</p></li>
</ul>
</div>
</div>
</div>
<div class="fragment">
<p>The Kaplan-Meier estimator formula is:</p>
</div>
<div class="fragment">
<p><span class="math display">\[
\hat{S}(d_k) = \prod_{j=1}^{k} \left( \frac{r_j - q_j}{r_j} \right)
\]</span></p>
</div>
<div class="fragment">
<p>For times between death times, <span class="math inline">\(\hat{S}(t)\)</span> remains constant, creating a step-like curve.</p>
</div>
</div>
</section>
<section id="the-kaplan-meier-estimator-explanation" class="level2">
<h2 class="anchored" data-anchor-id="the-kaplan-meier-estimator-explanation">The Kaplan-Meier Estimator: Explanation</h2>
<div style="font-size: 0.8em;">
<p>The formula is derived from the law of total probability:</p>
<p><span class="math display">\[
Pr(T &gt; d_k) = Pr(T &gt; d_k | T &gt; d_{k-1})Pr(T &gt; d_{k-1}) + Pr(T&gt;d_k|T \leq d_{k-1})Pr(T\leq d_{k-1})
\]</span></p>
<div class="fragment">
<p>Since <span class="math inline">\(d_{k-1} &lt; d_k\)</span>, <span class="math inline">\(Pr(T&gt;d_k|T \leq d_{k-1}) = 0\)</span>, then the above formula is: <span class="math display">\[
S(d_k) = Pr(T &gt; d_k) = Pr(T &gt; d_k | T &gt; d_{k-1})Pr(T &gt; d_{k-1})
\]</span></p>
</div>
<div class="fragment">
<p>Plug in <span class="math inline">\(S(t)\)</span> and rearrange the above formula: <span class="math display">\[
S(d_k) = Pr(T&gt;d_k|T&gt;d_{k-1}) \times ... \times Pr(T&gt;d_2|T&gt;d_1)Pr(T&gt;d_1)
\]</span></p>
</div>
<div class="fragment">
<p>We estimate each term on the right-hand side using the fraction of the risk set at time <span class="math inline">\(d_j\)</span> who survived past time <span class="math inline">\(d_j\)</span>:</p>
<p><span class="math display">\[\widehat{Pr}(T &gt; d_j | T &gt; d_{j-1}) = (r_j - q_j) / r_j\]</span></p>
</div>
<div class="fragment">
<p>Finally, we arrive at the Kaplan-Meier estimator:</p>
</div>
<div class="fragment">
<p><span class="math display">\[
\hat{S}(d_k) = \prod_{j=1}^{k} \left( \frac{r_j - q_j}{r_j} \right)
\]</span></p>
</div>
</div>
</section>
<section id="kaplan-meier-curve-example" class="level2">
<h2 class="anchored" data-anchor-id="kaplan-meier-curve-example">Kaplan-Meier Curve: Example</h2>
<div style="font-size: 0.8em;">
<p>Here‚Äôs the Kaplan-Meier curve for the <code>BrainCancer</code> data:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://axwslyfy9krb.objectstorage.ap-singapore-1.oci.customer-oci.com/n/axwslyfy9krb/b/qiufei/o/textbook%2Fisl_figures%2F11_2.svg" class="img-fluid figure-img"></p>
<figcaption>alt text</figcaption>
</figure>
</div>
<ul>
<li>The curve steps down at each observed death time.</li>
<li>The height of the curve at any time point represents the estimated survival probability.</li>
<li>The estimated probability of survival past 20 months is 71%.</li>
</ul>
</div>
</section>
<section id="comparing-survival-curves-the-log-rank-test" class="level2">
<h2 class="anchored" data-anchor-id="comparing-survival-curves-the-log-rank-test">Comparing Survival Curves: The Log-Rank Test</h2>
<div style="font-size: 0.8em;">
<p>Often, we want to compare survival curves between groups (e.g., males vs.&nbsp;females).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://axwslyfy9krb.objectstorage.ap-singapore-1.oci.customer-oci.com/n/axwslyfy9krb/b/qiufei/o/textbook%2Fisl_figures%2F11_3.svg" class="img-fluid figure-img"></p>
<figcaption>alt text</figcaption>
</figure>
</div>
<div class="fragment">
<p>The <strong>log-rank test</strong> is a statistical test for comparing survival curves. It accounts for censoring.</p>
</div>
</div>
</section>
<section id="log-rank-test-details" class="level2">
<h2 class="anchored" data-anchor-id="log-rank-test-details">Log-Rank Test: Details</h2>
<div style="font-size: 0.7em;">
<p>The log-rank test examines events sequentially, like the Kaplan-Meier estimator.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<ul>
<li>At each death time <span class="math inline">\(d_k\)</span>, we construct a 2x2 table:</li>
</ul>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Group 1</th>
<th style="text-align: left;">Group 2</th>
<th style="text-align: left;">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Died</td>
<td style="text-align: left;"><span class="math inline">\(q_{1k}\)</span></td>
<td style="text-align: left;"><span class="math inline">\(q_{2k}\)</span></td>
<td style="text-align: left;"><span class="math inline">\(q_k\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Survived</td>
<td style="text-align: left;"><span class="math inline">\(r_{1k}-q_{1k}\)</span></td>
<td style="text-align: left;"><span class="math inline">\(r_{2k}-q_{2k}\)</span></td>
<td style="text-align: left;"><span class="math inline">\(r_k-q_k\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;"><span class="math inline">\(r_{1k}\)</span></td>
<td style="text-align: left;"><span class="math inline">\(r_{2k}\)</span></td>
<td style="text-align: left;"><span class="math inline">\(r_k\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<ul>
<li><p><span class="math inline">\(r_{1k}\)</span>, <span class="math inline">\(r_{2k}\)</span>: Number at risk in each group at time <span class="math inline">\(d_k\)</span>.</p></li>
<li><p><span class="math inline">\(q_{1k}\)</span>, <span class="math inline">\(q_{2k}\)</span>: Number of deaths in each group at time <span class="math inline">\(d_k\)</span>.</p></li>
<li><p><strong>Key Idea:</strong> If there‚Äôs no difference in survival, we‚Äôd expect the <em>proportion</em> of deaths in each group to be proportional to the number at risk.</p></li>
</ul>
</div>
</div>
</div>
<div class="fragment">
<p>The log-rank test statistic (W) is calculated based on the <em>observed</em> and <em>expected</em> number of deaths in group 1:</p>
<p><span class="math display">\[
W = \frac{\sum_{k=1}^{K}(q_{1k} - \mu_k)}{\sqrt{\sum_{k=1}^{K}Var(q_{1k})}}
\]</span> where $ _k = q_k $ and <span class="math inline">\(Var(q_{1k}) = \frac{q_k(r_{1k}/r_k)(1-r_{1k}/r_k)(r_k - q_k)}{r_k - 1}\)</span></p>
</div>
<div class="fragment">
<p>Under the null hypothesis (no difference in survival), W approximately follows a standard normal distribution.</p>
</div>
</div>
</section>
<section id="log-rank-test-brain-cancer-example" class="level2">
<h2 class="anchored" data-anchor-id="log-rank-test-brain-cancer-example">Log-Rank Test: Brain Cancer Example</h2>
<div style="font-size: 0.8em;">
<p>Comparing survival times of males and females in the <code>BrainCancer</code> data:</p>
<ul>
<li>Log-rank test statistic W = 1.2.</li>
<li>Two-sided p-value = 0.2 (using the theoretical null distribution).</li>
<li>We <em>cannot</em> reject the null hypothesis of no difference in survival curves between males and females.</li>
</ul>
</div>
</section>
<section id="regression-models-with-a-survival-response" class="level2">
<h2 class="anchored" data-anchor-id="regression-models-with-a-survival-response">Regression Models with a Survival Response</h2>
<div style="font-size: 0.8em;">
<p>So far, we‚Äôve looked at describing survival curves and comparing them between groups. Now, we want to <em>predict</em> survival time based on covariates (features).</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<ul>
<li><p>We have observations of the form <span class="math inline">\((Y_i, \delta_i, X_i)\)</span>, where:</p>
<ul>
<li><span class="math inline">\(Y_i\)</span> is the observed time (min(T, C)).</li>
<li><span class="math inline">\(\delta_i\)</span> is the status indicator.</li>
<li><span class="math inline">\(X_i\)</span> is a vector of features.</li>
</ul></li>
<li><p>A simple linear regression of log(Y) on X is problematic due to censoring.</p></li>
<li><p><em>Why not regress on Y directly?</em>: We are interested in T not Y.</p></li>
</ul>
</div>
</div>
</div>
<div class="fragment">
<ul>
<li><strong>Solution:</strong> Use a sequential approach, similar to Kaplan-Meier and the log-rank test. We introduce the <strong>hazard function</strong>.</li>
</ul>
</div>
</div>
</section>
<section id="the-hazard-function" class="level2">
<h2 class="anchored" data-anchor-id="the-hazard-function">The Hazard Function</h2>
<div style="font-size: 0.8em;">
<p>The <strong>hazard function</strong>, h(t), is also known as the <em>hazard rate</em> or <em>force of mortality</em>. It represents the <em>instantaneous</em> risk of the event occurring at time t, given survival up to time t:</p>
<p><span class="math display">\[h(t) = \lim_{\Delta t \to 0} \frac{Pr(t &lt; T \leq t + \Delta t | T &gt; t)}{\Delta t}\]</span></p>
<div class="fragment">
<ul>
<li>Think of it as the ‚Äúdeath rate‚Äù in a tiny interval after time t, given survival up to t.</li>
<li>It‚Äôs closely related to the survival curve, S(t).</li>
<li>It‚Äôs crucial for modeling survival data as a function of covariates.</li>
</ul>
</div>
</div>
</section>
<section id="hazard-function-more-details" class="level2">
<h2 class="anchored" data-anchor-id="hazard-function-more-details">Hazard Function: More Details</h2>
<div style="font-size: 0.8em;">
<p><span class="math display">\[
\begin{aligned}
h(t) &amp;= \lim_{\Delta t \to 0} Pr((t&lt;T\le t+\Delta t)\cap (T&gt;t))/\Delta t \over Pr(T&gt;t) \\
&amp;= \lim_{\Delta t \to 0} {Pr(t&lt;T\le t+\Delta t) / \Delta t \over Pr(T&gt;t)} \\
&amp;= {f(t) \over S(t)}
\end{aligned}
\]</span></p>
<p>where <span class="math display">\[
f(t) = \lim_{\Delta t\to 0} {Pr(t&lt;T\le t+\Delta t)\over \Delta t}
\]</span></p>
<div class="fragment">
<p><span class="math inline">\(f(t)\)</span> is probability density function.</p>
</div>
<div class="fragment">
<p>The likelihood associated with the i-th observation is:</p>
<p><span class="math display">\[
L_i = \begin{cases}
f(y_i) \quad \text{if the i-th observation is not censored} \\
S(y_i) \quad \text{if the i-th observation is censored}
\end{cases} \\
= f(y_i)^{\delta_i}S(y_i)^{1-\delta_i}
\]</span></p>
</div>
<div class="fragment">
<p>If <span class="math inline">\(Y=y_i\)</span> and the i-th observation is not censored, then the likelihood is the probability of dying in a tiny interval around time <span class="math inline">\(y_i\)</span>. If the i-th observation is censored, then the likelihood is the probability of surviving at least until time <span class="math inline">\(y_i\)</span></p>
</div>
</div>
</section>
<section id="cox-proportional-hazards-model" class="level2">
<h2 class="anchored" data-anchor-id="cox-proportional-hazards-model">Cox Proportional Hazards Model</h2>
<div style="font-size: 0.8em;">
<p>The <strong>Cox proportional hazards model</strong> is a powerful and flexible approach to model the relationship between covariates and the hazard function.</p>
<div class="fragment">
<p><strong>The Proportional Hazards Assumption:</strong></p>
</div>
<p><span class="math display">\[h(t|x_i) = h_0(t) \exp(\sum_{j=1}^{p} x_{ij}\beta_j)\]</span></p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<ul>
<li><p><span class="math inline">\(h(t|x_i)\)</span>: Hazard function for an individual with features <span class="math inline">\(x_i\)</span>.</p></li>
<li><p><span class="math inline">\(h_0(t)\)</span>: <strong>Baseline hazard function</strong>. This is the hazard for an individual with all features equal to zero. It‚Äôs left <em>unspecified</em>.</p></li>
<li><p><span class="math inline">\(\exp(\sum_{j=1}^{p} x_{ij}\beta_j)\)</span>: <strong>Relative risk</strong>. It‚Äôs a multiplicative factor that scales the baseline hazard based on the features.</p></li>
<li><p>The key is that we don‚Äôt assume a specific form for <span class="math inline">\(h_0(t)\)</span>. This makes the model very flexible.</p></li>
<li><p>A one-unit increase in <span class="math inline">\(x_{ij}\)</span> multiplies the hazard by a factor of <span class="math inline">\(\exp(\beta_j)\)</span>.</p></li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="proportional-hazards-illustration" class="level2">
<h2 class="anchored" data-anchor-id="proportional-hazards-illustration">Proportional Hazards: Illustration</h2>
<div style="font-size: 0.8em;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://axwslyfy9krb.objectstorage.ap-singapore-1.oci.customer-oci.com/n/axwslyfy9krb/b/qiufei/o/textbook%2Fisl_figures%2F11_4.svg" class="img-fluid figure-img"></p>
<figcaption>alt text</figcaption>
</figure>
</div>
<ul>
<li><strong>Top Row:</strong> Proportional hazards <em>holds</em>. Log hazard functions are parallel; survival curves don‚Äôt cross.</li>
<li><strong>Bottom Row:</strong> Proportional hazards <em>doesn‚Äôt hold</em>. Log hazard and survival curves cross.</li>
</ul>
</div>
</section>
<section id="cox-proportional-hazards-model-estimation" class="level2">
<h2 class="anchored" data-anchor-id="cox-proportional-hazards-model-estimation">Cox Proportional Hazards Model: Estimation</h2>
<div style="font-size: 0.7em;">
<p>How do we estimate the coefficients, <span class="math inline">\(\beta\)</span>, in the Cox model <em>without</em> knowing <span class="math inline">\(h_0(t)\)</span>? We use the <strong>partial likelihood</strong>.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<ul>
<li><p>Assume no ties in failure times.</p></li>
<li><p>Consider the <em>i</em>th observation, which <em>fails</em> at time <span class="math inline">\(y_i\)</span> (<span class="math inline">\(\delta_i = 1\)</span>).</p></li>
<li><p>What‚Äôs the probability that <em>this</em> observation fails at <span class="math inline">\(y_i\)</span>, given the set of individuals at risk at that time?</p></li>
<li><p>The probability that i-th observation is the one to fail at time <span class="math inline">\(y_i\)</span> is:</p></li>
</ul>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p><span class="math display">\[
\frac{h_0(y_i) \exp(\sum_{j=1}^p x_{ij}\beta_j)}{\sum_{i':y_{i'}\ge y_i}h_0(y_i)\exp(\sum_{j=1}^{p}x_{i'j}\beta_j)} = \frac{\exp(\sum_{j=1}^p x_{ij}\beta_j)}{\sum_{i':y_{i'}\ge y_i}\exp(\sum_{j=1}^{p}x_{i'j}\beta_j)}
\]</span></p>
</div>
</div>
</div>
<div class="fragment">
<ul>
<li>Crucially, <span class="math inline">\(h_0(y_i)\)</span> cancels out!</li>
<li>The <strong>partial likelihood</strong> is the product of these probabilities over all <em>uncensored</em> observations:</li>
</ul>
</div>
<div class="fragment">
<p><span class="math display">\[PL(\beta) = \prod_{i:\delta_i = 1} \frac{\exp(\sum_{j=1}^p x_{ij}\beta_j)}{\sum_{i':y_{i'}\ge y_i}\exp(\sum_{j=1}^{p}x_{i'j}\beta_j)}\]</span></p>
</div>
<div class="fragment">
<ul>
<li>We estimate <span class="math inline">\(\beta\)</span> by maximizing the partial likelihood.</li>
<li>This is done numerically (no closed-form solution).</li>
</ul>
</div>
</div>
</section>
<section id="cox-model-example-brain-cancer-data" class="level2">
<h2 class="anchored" data-anchor-id="cox-model-example-brain-cancer-data">Cox Model: Example (Brain Cancer Data)</h2>
<div style="font-size: 0.8em;">
<p>Let‚Äôs apply the Cox model to the <code>BrainCancer</code> data:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 34%">
<col style="width: 18%">
<col style="width: 16%">
<col style="width: 18%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Coefficient</th>
<th>Std. error</th>
<th>z-statistic</th>
<th>p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>sex[Male]</td>
<td>0.18</td>
<td>0.36</td>
<td>0.51</td>
<td>0.61</td>
</tr>
<tr class="even">
<td>diagnosis[LG Glioma]</td>
<td>0.92</td>
<td>0.64</td>
<td>1.43</td>
<td>0.15</td>
</tr>
<tr class="odd">
<td>diagnosis[HG Glioma]</td>
<td>2.15</td>
<td>0.45</td>
<td>4.78</td>
<td>0.00</td>
</tr>
<tr class="even">
<td>diagnosis[Other]</td>
<td>0.89</td>
<td>0.66</td>
<td>1.35</td>
<td>0.18</td>
</tr>
<tr class="odd">
<td>loc[Supratentorial]</td>
<td>0.44</td>
<td>0.70</td>
<td>0.63</td>
<td>0.53</td>
</tr>
<tr class="even">
<td>ki</td>
<td>-0.05</td>
<td>0.02</td>
<td>-3.00</td>
<td>&lt;0.01</td>
</tr>
<tr class="odd">
<td>gtv</td>
<td>0.03</td>
<td>0.02</td>
<td>1.54</td>
<td>0.12</td>
</tr>
<tr class="even">
<td>stereo[SRT]</td>
<td>0.18</td>
<td>0.60</td>
<td>0.30</td>
<td>0.77</td>
</tr>
</tbody>
</table>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<ul>
<li><strong>Interpretation:</strong>
<ul>
<li>Males have an estimated hazard 1.2 times greater than females (e<sup>0.18</sup>), but this is not statistically significant.</li>
<li>Higher Karnofsky index (ki) is associated with a <em>lower</em> hazard (e<sup>-0.05</sup> = 0.95), and this effect is significant.</li>
</ul></li>
<li>The p-value associated with a coefficient tests the null hypothesis that the coefficient is zero.</li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="cox-model-example-publication-data" class="level2">
<h2 class="anchored" data-anchor-id="cox-model-example-publication-data">Cox Model: Example (Publication Data)</h2>
<div style="font-size: 0.8em;">
<p>Next, we will introduce the dataset <code>Publication</code>, involving the time to publication of journal papers reporting the results of clinical trials funded by the National Heart, Lung, and Blood Institue. For 244 trials, the time in months until publication is recorded.</p>
</div>
<div style="font-size: 0.8em;">
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://axwslyfy9krb.objectstorage.ap-singapore-1.oci.customer-oci.com/n/axwslyfy9krb/b/qiufei/o/textbook%2Fisl_figures%2F11_5.svg" class="img-fluid figure-img"></p>
<figcaption>alt text</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<ul>
<li><p>Using the log-rank test, we can test whether the studies with positive results have significant difference in publication time.</p></li>
<li><p>The figure shows slight evidence that time until publication is lower for studies with a positive result.</p></li>
<li><p>However, the log-rank test yields a very unimpressive p-value of 0.36.</p></li>
</ul>
</div>
</div>
</div>
<div style="font-size: 0.8em;">
<p>Now, let‚Äôs fit Cox‚Äôs proportional hazards model using all available features:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Variable</th>
<th>Coefficient</th>
<th>Std. error</th>
<th>z-statistic</th>
<th>p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>posres[Yes]</td>
<td>0.55</td>
<td>0.18</td>
<td>3.02</td>
<td>0.00</td>
</tr>
<tr class="even">
<td>multi[Yes]</td>
<td>0.15</td>
<td>0.31</td>
<td>0.47</td>
<td>0.64</td>
</tr>
<tr class="odd">
<td>clinend[Yes]</td>
<td>0.51</td>
<td>0.27</td>
<td>1.89</td>
<td>0.06</td>
</tr>
<tr class="even">
<td>mech[K01]</td>
<td>1.05</td>
<td>1.06</td>
<td>1.00</td>
<td>0.32</td>
</tr>
<tr class="odd">
<td>mech[K23]</td>
<td>-0.48</td>
<td>1.05</td>
<td>-0.45</td>
<td>0.65</td>
</tr>
<tr class="even">
<td>mech[P01]</td>
<td>-0.31</td>
<td>0.78</td>
<td>-0.40</td>
<td>0.69</td>
</tr>
<tr class="odd">
<td>mech[P50]</td>
<td>0.60</td>
<td>1.06</td>
<td>0.57</td>
<td>0.57</td>
</tr>
<tr class="even">
<td>mech[R01]</td>
<td>0.10</td>
<td>0.32</td>
<td>0.30</td>
<td>0.76</td>
</tr>
<tr class="odd">
<td>mech[R18]</td>
<td>1.05</td>
<td>1.05</td>
<td>0.99</td>
<td>0.32</td>
</tr>
<tr class="even">
<td>mech[R21]</td>
<td>-0.05</td>
<td>1.06</td>
<td>-0.04</td>
<td>0.97</td>
</tr>
<tr class="odd">
<td>mech[R24, K24]</td>
<td>0.81</td>
<td>1.05</td>
<td>0.77</td>
<td>0.44</td>
</tr>
<tr class="even">
<td>mech[R42]</td>
<td>-14.78</td>
<td>3414.38</td>
<td>-0.00</td>
<td>1.00</td>
</tr>
<tr class="odd">
<td>mech[R44]</td>
<td>-0.57</td>
<td>0.77</td>
<td>-0.73</td>
<td>0.46</td>
</tr>
<tr class="even">
<td>mech[RC2]</td>
<td>-14.92</td>
<td>2243.60</td>
<td>-0.01</td>
<td>0.99</td>
</tr>
<tr class="odd">
<td>mech[U01]</td>
<td>-0.22</td>
<td>0.32</td>
<td>-0.70</td>
<td>0.48</td>
</tr>
<tr class="even">
<td>mech[U54]</td>
<td>0.47</td>
<td>1.07</td>
<td>0.44</td>
<td>0.66</td>
</tr>
<tr class="odd">
<td>sampsize</td>
<td>0.00</td>
<td>0.00</td>
<td>0.19</td>
<td>0.85</td>
</tr>
<tr class="even">
<td>budget</td>
<td>0.00</td>
<td>0.00</td>
<td>1.67</td>
<td>0.09</td>
</tr>
<tr class="odd">
<td>impact</td>
<td>0.06</td>
<td>0.01</td>
<td>8.23</td>
<td>0.00</td>
</tr>
</tbody>
</table>
<ul>
<li>We find that the chance of publication of a study with a positive result is <span class="math inline">\(e^{0.55} = 1.74\)</span> time higher than the chance of publication of a study with a negative result at any point in time, holding all other covariates fixed.</li>
</ul>
</div>
</div>
</section>
<section id="cox-model-example-publication-data---adjusted-curves" class="level2">
<h2 class="anchored" data-anchor-id="cox-model-example-publication-data---adjusted-curves">Cox Model: Example (Publication Data) - Adjusted Curves</h2>
<div style="font-size: 0.8em;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://axwslyfy9krb.objectstorage.ap-singapore-1.oci.customer-oci.com/n/axwslyfy9krb/b/qiufei/o/textbook%2Fisl_figures%2F11_6.svg" class="img-fluid figure-img"></p>
<figcaption>alt text</figcaption>
</figure>
</div>
<ul>
<li>After <em>adjusting</em> for other covariates (using representative values), we see a much clearer difference in survival curves between positive and negative results.</li>
<li>This highlights the importance of considering multiple predictors.</li>
</ul>
</div>
</section>
<section id="shrinkage-for-the-cox-model" class="level2">
<h2 class="anchored" data-anchor-id="shrinkage-for-the-cox-model">Shrinkage for the Cox Model</h2>
<div style="font-size: 0.8em;">
<p>We can apply shrinkage methods (like ridge and lasso) to the Cox model.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<ul>
<li><p><strong>Idea:</strong> Minimize a penalized version of the negative log partial likelihood:</p>
<p><span class="math display">\[-\log\left(\prod_{i:\delta_i=1} \frac{\exp(\sum_{j=1}^p x_{ij}\beta_j)}{\sum_{i':y_{i'}\ge y_i}\exp(\sum_{j=1}^{p}x_{i'j}\beta_j)}\right) + \lambda P(\beta)\]</span></p>
<ul>
<li><span class="math inline">\(\lambda\)</span>: Tuning parameter.</li>
<li><span class="math inline">\(P(\beta)\)</span>: Penalty term (e.g., lasso: <span class="math inline">\(\sum_{j=1}^p |\beta_j|\)</span>).</li>
</ul></li>
<li><p>We now apply lasso-penalized Cox model to the <code>Publication</code> data.</p></li>
<li><p>The figure on the right hand displays the cross-validation results.</p></li>
<li><p>Note the ‚ÄúU-shape‚Äù of the partial likelihood deviance.</p></li>
<li><p>Specifically, the cross-validation error is minimized when just two predictors, <code>budget</code> and <code>impact</code>, have non-zero estimated coefficients.</p></li>
</ul>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://axwslyfy9krb.objectstorage.ap-singapore-1.oci.customer-oci.com/n/axwslyfy9krb/b/qiufei/o/textbook%2Fisl_figures%2F11_7.svg" class="img-fluid figure-img"></p>
<figcaption>Partial likelihood deviance</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="assessing-model-fit-on-test-data" class="level2">
<h2 class="anchored" data-anchor-id="assessing-model-fit-on-test-data">Assessing Model Fit on Test Data</h2>
<div style="font-size: 0.8em;">
<p>We can use risk score to categorize the observations based on their ‚Äúrisk‚Äù. For example, we use the risk score: <span class="math display">\[
budget_i \cdot \hat{\beta}_{budget} + impact_i \cdot \hat{\beta}_{impact}
\]</span> where <span class="math inline">\(\hat{\beta}_{budget}\)</span> and <span class="math inline">\(\hat{\beta}_{impact}\)</span> are the coefficients estimates for these two features from the training set.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://axwslyfy9krb.objectstorage.ap-singapore-1.oci.customer-oci.com/n/axwslyfy9krb/b/qiufei/o/textbook%2Fisl_figures%2F11_8.svg" class="img-fluid figure-img"></p>
<figcaption>alt text</figcaption>
</figure>
</div>
<p>The figure shows that there is clear seperation between the three strata, and that the strata are correctly ordered in terms of low, medium, and high risk of publication.</p>
</div>
</section>
<section id="additional-topics" class="level2">
<h2 class="anchored" data-anchor-id="additional-topics">Additional Topics</h2>
<div style="font-size: 0.8em;">
<ul>
<li><strong>Area Under the Curve (AUC) for Survival Analysis:</strong> Harrell‚Äôs concordance index (C-index) generalizes AUC to survival data, accounting for censoring.</li>
<li><strong>Choice of Time Scale:</strong> The definition of ‚Äútime zero‚Äù can be crucial and depends on the context.</li>
<li><strong>Time-Dependent Covariates:</strong> The Cox model can handle predictors that change over time.</li>
<li><strong>Checking the Proportional Hazards Assumption:</strong> Visual checks (log hazard plots) and stratification can help assess the assumption.</li>
<li><strong>Survival Trees:</strong> Tree-based methods can be adapted for survival analysis.</li>
</ul>
</div>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<div style="font-size: 0.8em;">
<ul>
<li>Survival analysis deals with <em>time-to-event</em> data, where <strong>censoring</strong> is a key challenge.</li>
<li>The <strong>Kaplan-Meier estimator</strong> provides a non-parametric estimate of the survival curve.</li>
<li>The <strong>log-rank test</strong> compares survival curves between groups.</li>
<li>The <strong>Cox proportional hazards model</strong> allows us to model the relationship between covariates and the <em>hazard function</em>, making it a powerful tool for prediction.</li>
<li>Shrinkage methods can be applied to the Cox model.</li>
<li>Various extensions and considerations (AUC, time scale, time-dependent covariates, proportional hazards assumption, survival trees) broaden the applicability of survival analysis.</li>
</ul>
</div>
</section>
<section id="thoughts-and-discussion" class="level2">
<h2 class="anchored" data-anchor-id="thoughts-and-discussion">Thoughts and Discussion</h2>
<div style="font-size: 0.8em;">
<ul>
<li>How might survival analysis be applied in <em>your</em> field of interest?</li>
<li>What are the ethical considerations when dealing with survival data, especially in medical contexts?</li>
<li>How could you explain the concept of censoring to someone without a statistical background?</li>
<li>Can you think of situations where the proportional hazards assumption might be violated? How could you address this?</li>
<li>What are the limitations of survival analysis? What types of questions can it <em>not</em> answer?</li>
</ul>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/qiufei\.github\.io\/web-slide-r");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>üîã<a href="https://posit.co"><img src="https://posit.co/wp-content/themes/Posit/assets/images/posit-logo-2024.svg" class="img-fluid" alt="Posit" width="65"></a></p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 ÈÇ±È£û ¬© 2025
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://beian.miit.gov.cn">
<p>ÊµôICPÂ§á 2024072710Âè∑-1</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33021202002511">
<p>ÊµôÂÖ¨ÁΩëÂÆâÂ§á 33021202002511Âè∑</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:hfutqiufei@163.com">
      <i class="bi bi-envelope-at-fill" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>